<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>ActiveMQ | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、ActiveMQ简介http:&#x2F;&#x2F;activemq.apache.org&#x2F;本文版本：5.14.3本文案例可以参考learn&#x2F;learn-mq-activemq 项目 ActiveMQ是什么ActiveMQ是Apache推出的，一款开源的，完全支持JMS1.1和J2EE1.4规范的JMS Provider实现的消中间件（MOM） ActiveMQ能干什么最主要的功能就是：实现JMS Provid">
<meta property="og:type" content="article">
<meta property="og:title" content="ActiveMQ">
<meta property="og:url" content="http://example.com/2020/09/14/ActiveMQ/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、ActiveMQ简介http:&#x2F;&#x2F;activemq.apache.org&#x2F;本文版本：5.14.3本文案例可以参考learn&#x2F;learn-mq-activemq 项目 ActiveMQ是什么ActiveMQ是Apache推出的，一款开源的，完全支持JMS1.1和J2EE1.4规范的JMS Provider实现的消中间件（MOM） ActiveMQ能干什么最主要的功能就是：实现JMS Provid">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-09-14T03:43:58.571Z">
<meta property="article:modified_time" content="2020-09-16T03:41:02.488Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ActiveMQ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/14/ActiveMQ/" class="article-date">
  <time datetime="2020-09-14T03:43:58.571Z" itemprop="datePublished">2020-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/MQ/">MQ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ActiveMQ
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2><span id="yi-activemq-jian-jie">一、ActiveMQ简介</span><a href="#yi-activemq-jian-jie" class="header-anchor"></a></h2><p><a target="_blank" rel="noopener" href="http://activemq.apache.org/">http://activemq.apache.org/</a><br>本文版本：5.14.3<br>本文案例可以参考learn/learn-mq-activemq 项目</p>
<h4><span id="activemq-shi-shi-me">ActiveMQ是什么</span><a href="#activemq-shi-shi-me" class="header-anchor"></a></h4><p>ActiveMQ是Apache推出的，一款开源的，完全支持JMS1.1和J2EE1.4规范的JMS Provider实现的消中间件（MOM）</p>
<h4><span id="activemq-neng-gan-shi-me">ActiveMQ能干什么</span><a href="#activemq-neng-gan-shi-me" class="header-anchor"></a></h4><p>最主要的功能就是：实现JMS Provider用来帮助实现高可用、高性能、可伸缩、易用和安全的企业级面向消息服务的系统</p>
<h4><span id="activemq-te-dian">ActiveMQ特点</span><a href="#activemq-te-dian" class="header-anchor"></a></h4><p>1.完全支持JMSI.1和J2EE1.4规范（持久化，XA消息，事务〕<br>2.支持多种传送协议：in-VM,TCP,SSL,UDP,JGroups,JXTA<br>3.可插拔的体系结构，可以灵活定制，如：消息存储方式、安全管理等<br>4.很容易和Application Server集成使用<br>5.多种语言和协议编写客户端。语言Java,C,C++,C#,Ruby，P以Python,PHP<br>6.从设计上保证了高性能的集群，客户端一服务器，点对点<br>7.可以很容易的和spring结合使用<br>8.支持通过JDBC和journal提供高速的消息持久化<br>9.支持与Axis的整合</p>
<h2><span id="er-an-zhuang">二、安装</span><a href="#er-an-zhuang" class="header-anchor"></a></h2><h3><span id="2-1-dan-ji-an-zhuang">2.1单机安装</span><a href="#2-1-dan-ji-an-zhuang" class="header-anchor"></a></h3><pre><code>本文采用docker安装
1、搜索 ActiveMQ 镜像
    docker search activemq
2、获取 ActiveMQ 镜像
    docker pull webcenter/activemq
    获取后查看本地镜像 docker image
3、docker 启动 ActiveMQ 命令
    docker run -d --name activemq -p 61616:61616 -p 8161:8161 webcenter/activemq
  // 端口映射可以参考docker的端口映射规则
  // 61616是 activemq 的容器使用端口
  // 8161是 web 页面管理端口
4、查看 Docker中ActiveMQ 运行情况
    docker ps -a
5、访问控制台页面
    http://localhost:8161/admin/index.jsp
    默认用户名密码 admin/admin
6、进入 ActiveMQ 所在目录
 docker exec -it activemq /bin/bash </code></pre>
<h3><span id="2-2-gao-ke-yong-an-zhuang">2.2 高可用安装</span><a href="#2-2-gao-ke-yong-an-zhuang" class="header-anchor"></a></h3><h2><span id="san-topic-he-queue">三、Topic 和Queue</span><a href="#san-topic-he-queue" class="header-anchor"></a></h2><h3><span id="3-1-gai-nian">3.1 概念</span><a href="#3-1-gai-nian" class="header-anchor"></a></h3><pre><code>JMS中定义了两种消息模型：点对点（point to point， queue）和发布/订阅（publish/subscribe，topic）。主要区别就是是否能重复消费。
Queue 点对点
消息生产者生产消息发送到queue中，然后消息消费者从queue中取出并且消费消息。消息被消费以后，queue中不再有存储，所以消息消费者不可能消费到已经被消费的消息。Queue支持存在多个消费者，但是对一个消息而言，只会有一个消费者可以消费、其它的则不能消费此消息了。当消费者不存在时，消息会一直保存，直到有消费消费
Topic 发布/订阅
消息生产者（发布）将消息发布到topic中，同时有多个消息消费者（订阅）消费该消息。和点对点方式不同，发布到topic的消息会被所有订阅者消费。当生产者发布消息，不管是否有消费者。都不会保存消息</code></pre>
<h3><span id="3-2-dui-bi-topic-he-queue">3.2 对比Topic 和Queue</span><a href="#3-2-dui-bi-topic-he-queue" class="header-anchor"></a></h3><table>
<thead>
<tr>
<th></th>
<th>Topic</th>
<th>Queue</th>
</tr>
</thead>
<tbody><tr>
<td>概要</td>
<td>Publish Subscribe messaging 发布订阅消息</td>
<td>Point-to-Point 点对点</td>
</tr>
<tr>
<td>有无状态</td>
<td>topic数据默认不落地，是无状态的。</td>
<td>Queue数据默认会在mq服务器上以文件形式保存，比如Active MQ一般保存在$AMQ_HOME\data\kr-store\data下面。也可以配置成DB存储。</td>
</tr>
<tr>
<td>完整性保障</td>
<td>并不保证publisher发布的每条数据，Subscriber都能接受到。</td>
<td>Queue保证每条数据都能被receiver接收。</td>
</tr>
<tr>
<td>消息是否会丢失</td>
<td>一般来说publisher发布消息到某一个topic时，只有正在监听该topic地址的sub能够接收到消息；如果没有sub在监听，该topic就丢失了。</td>
<td>Sender发送消息到目标Queue，receiver可以异步接收这个Queue上的消息。Queue上的消息如果暂时没有receiver来取，也不会丢失。</td>
</tr>
<tr>
<td>消息发布接收策略</td>
<td>一对多的消息发布接收策略，监听同一个topic地址的多个sub都能收到publisher发送的消息。Sub接收完通知mq服务器</td>
<td>一对一的消息发布接收策略，一个sender发送的消息，只能有一个receiver接收。receiver接收完后，通知mq服务器已接收，mq服务器对queue里的消息采取删除或其他操作。</td>
</tr>
</tbody></table>
<h3><span id="3-3-chuan-shu-xie-yi">3.3 传输协议</span><a href="#3-3-chuan-shu-xie-yi" class="header-anchor"></a></h3><h3><span id="3-3-1-zhi-chi-de-chuan-shu-xie-yi">3.3.1支持的传输协议</span><a href="#3-3-1-zhi-chi-de-chuan-shu-xie-yi" class="header-anchor"></a></h3><p>Connector：ActiveMQ提供的，用来实现连接通讯的功能。包括：client-to-broker、broker-to-broker。ActiveMQ允许客户端使用多种协议来连接配置Transport Connector，在conf/activemq.xml中，配置如下：<br>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnectors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;openwire&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;tcp://localhost:61616&quot;</span> <span class="attr">discoveryUri</span>=<span class="string">&quot;multicast://default&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;ssl&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;ssl://localhost:61617&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;stomp&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;stomp://localhost:61613&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;xmpp&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;xmpp://localhost:61222&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transportConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure><br>ActiveMQ支持的client-broker通讯协议如下：<br>  1：TCP：这个也是缺省使用的协议<br>  2：NIO<br>  3：UDP<br>  4：SSL<br>  5：Http(s)<br>  6：VM：如果客户端和broker在一个虚拟机内的话，通过VM协议通讯在VM内通讯，从而减少网络传输的开销。</p>
<h4><span id="xie-yi-xiang-xi-jie-shao">协议详细介绍</span><a href="#xie-yi-xiang-xi-jie-shao" class="header-anchor"></a></h4><h5><span id="tcp">TCP</span><a href="#tcp" class="header-anchor"></a></h5><p>Transmission Control Protocol（TCP）<br>  1：这是默认的Broker配置，TCP的Client监听端口是61616。<br>  2：在网络传输数据前，必须要序列化数据，消息是通过一个叫wire protocol的来序列化成字节流。默认情况下，ActiveMQ把wire protocol叫做0penWire，它的目的是促使网络上的效率和数据快速交互。<br>  3．TCP连接的URI形式：tcp://hostname:port?key=value&amp;key=value,加粗部分是必须的<br>  4：TCP传输的优点：<br>  （1）TCP协议传输可靠性高，稳定性强<br>  （2）高效性：字节流方式传递，效率很高<br>  （3）有效性、可用性：应用广泛，支持任何平台<br>  5：所有关于Transport协议的可配置参数，可以参见：<br>  <a target="_blank" rel="noopener" href="http://activemq.apache.org/configuring-version-5-transports.html">http://activemq.apache.org/configuring-version-5-transports.html</a></p>
<h5><span id="nio">NIO</span><a href="#nio" class="header-anchor"></a></h5><p>New I/O API Protocol<br>  1:NIO协议和TCP协议类似，但NIO更侧重于底层的访问操作。它允许开发人员对同一资源可有更多的client调用和服务端有更多的负载。<br>  2：适合使用NI0协议的场景：<br>  （1）可能有大量的Client去链接到Broker上<br>  一般情况下，大量的Client去链接Brokerr是被操作系統的线程所限制的。因此，NIO的实现比TCP需要更少的线程去运行，所以建议使用NIO协议。<br>  （2）可能对于Broker有一个很迟钝的网络传输，NIO比TCP提供更好的性能<br>  3：NIO连接URI形式：<strong>nio://hostname:port</strong>?Key=value<br>  4：Transport Connector配置示例</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnectors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;tcp&quot;</span>  <span class="attr">uri</span>=<span class="string">&quot;tcp://localhost:61616?Trace=true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;nio&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;nio://localhost:61617?Trace=true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transportConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  上面的配置，示范了一个TCP协议监听61616端口，一个NI0协议监听61617端口</p>
<h5><span id="udp">UDP</span><a href="#udp" class="header-anchor"></a></h5><p>User Datasgram Protocol<br>  1：UDP和TCP的区别<br>  (1)TCP是一个原始流的传递协义，意味着数据包是有保证的，换句话说，数据包是不会被复制和丢夫的。UDP，另一方面，它是不会保证数据包的传递的。<br>  (2)TCP也是一个稳定可靠的数据包传递协议，意味着数据在传递的过程中不会被丢夫。这样确保了在发送和接收之间能够可靠的传递。相反，UDP仅仅是一个链接协议，所以它没有可靠性之说。<br>  2：从上面可以得出：TCP是被用在稳定可靠的场景中使用的；UDP通常用在快速数据传递和不怕数据丢夫的场景中，还有ActiveMQ通过防火墙时，只能用UDP<br>  3：UDP连接的URI形式：<strong>udp://hostname:port</strong>?Key=value<br>  4：Transport Connector配置示例：<br>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnectors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;udp&quot;</span>  <span class="attr">uri</span>=<span class="string">&quot;udp://localhost:61618?Trace=true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transportConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5><span id="ssl">SSL</span><a href="#ssl" class="header-anchor"></a></h5><p>Secure Sockets Layer Protocol<br>  1：连接的URI形式：<strong>ssl://hostname:port</strong>?key=value<br>  2：Transport Connector配置示例：<br>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnectors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;ssl&quot;</span>          <span class="attr">uri</span>=<span class="string">&quot;ssl://localhost:61619?Trace=true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transportConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5><span id="http-https">HTTP/HTTPS</span><a href="#http-https" class="header-anchor"></a></h5><p>Hypertext Transfer Protocol<br>  1：像web和email等服务需要通过防火墙来访问的，Http可以使用这种场合<br>  2：连接的URI形式：<strong>http(s)://hostname:port</strong>?Key=value<br>  3：Transport Connector配置示例：<br>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transportConnectors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transportConnector</span> <span class="attr">name</span>=<span class="string">&quot;http&quot;</span> <span class="attr">uri</span>=<span class="string">&quot;http://localhost:61620?Trace=true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transportConnectors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5><span id="vm">VM</span><a href="#vm" class="header-anchor"></a></h5><p>VM Protocol<br>  1：VM transport允许在内部通讯，从而避免了网络传输的开销。这时候采用的连接不是socket连接，而是直接的方法调用。<br>  2：第一个创建连接的客户会启动一个embed broker，接下来所有使用相同的<br>  Broker name的VM连接都会使用这个broker。当这个broker上所有的连接都关闭的时候，这个broker也会自动关闭。<br>  3：连接的URI形式：vm://brokerName?key=va1ue<br>  4：Java内嵌入的方式：<br>  vm:broke：(tcp://localhost：6000）?brokerName=embeddedbbroker&amp;persistent=false，定义了一个嵌入的broker名称为embededbroker以及配置了一个tcptransprotconnector在监听端口6000上<br>  5：使用一个加载个配置文件来启动broker<br>  Vm://localhost?brokerConfig=xbean:activemq.xml</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/14/ActiveMQ/" data-id="ckf7n3lla00024pol6hsy03wh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2020/09/08/Vue%E5%9F%BA%E7%A1%80/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Vue基础</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/14/ActiveMQ/">ActiveMQ</a>
          </li>
        
          <li>
            <a href="/2020/09/08/Vue%E5%9F%BA%E7%A1%80/">Vue基础</a>
          </li>
        
          <li>
            <a href="/2020/09/08/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/09/05/MQ%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/">MQ 基础理论</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>